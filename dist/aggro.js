'use strict';var _slicedToArray=function(){function c(e,f){var g=[],h=!0,j=!1,k=void 0;try{for(var m,l=e[Symbol.iterator]();!(h=(m=l.next()).done)&&(g.push(m.value),!(f&&g.length===f));h=!0);}catch(o){j=!0,k=o}finally{try{!h&&l['return']&&l['return']()}finally{if(j)throw k}}return g}return function(e,f){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return c(e,f);throw new TypeError('Invalid attempt to destructure non-iterable instance')}}(),_typeof='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(c){return typeof c}:function(c){return c&&'function'==typeof Symbol&&c.constructor===Symbol&&c!==Symbol.prototype?'symbol':typeof c};(function(c,e){'function'==typeof define&&define.amd?define([],e):'object'===('undefined'==typeof module?'undefined':_typeof(module))&&module.exports?module.exports=e():c.aggro=e()})(void 0,function(){function c(){function p(v){var w=v.filter(function(x){for(var y=0;y<q.length;y++){var z=q[y],A=z.key?e(x[z.key]):x;if(z.test){if(!z.test(A,x[z.key]))return!1;}else if('<='===z.type){if(A>z.value)return!1;}else if('>='===z.type){if(A<z.value)return!1;}else if('>'===z.type){if(A<=z.value)return!1;}else if('<'===z.type){if(A>=z.value)return!1;}else if('in'===z.type){var B=z.value;if(1===B.length){if(B[0]!==A)return!1;}else if(-1===B.indexOf(A))return!1}}return!0});return w=m(w,t,r),u&&w.sort(function(x,y){return u(e(x.key),e(y.key))}),w}var q=[],r=[],t=[],u=null;return p.filter=function(v,w){if('object'===('undefined'==typeof v?'undefined':_typeof(v)))q.push(v);else if('function'==typeof v&&!w)q.push({key:null,type:'eq',test:v});else{if('function'!=typeof w&&void 0!==w){var x=e(w);w=function test(y){return y===x}}w?q.push({key:v,type:'eq',test:w}):console.warn('Aggro.filter was called without any filter created!')}return p},p.in=function(v,w){var x=(Array.isArray(w)?w:[w]).filter(f);return x.length&&p.filter({key:v,type:'in',value:k(x).map(e)}),p},p.between=function(v,w){var x=null,y=null;if(!Array.isArray(w))return p.filter(v,w);if(1===w.length)return p.filter(v,w[0]);if(2===w.length){var z=_slicedToArray(w,2);x=z[0],y=z[1]}else if(2<w.length){var A=j(w.filter(function(C){return null!=C})),B=_slicedToArray(A,2);x=B[0],y=B[1]}return null!=x&&p.filter({key:v,type:'>=',value:x}),null!=y&&p.filter({key:v,type:'<=',value:y}),p},p.aggregate=function(v,w,x){var y=3<arguments.length&&void 0!==arguments[3]?arguments[3]:'aggr_'+v;return r.push([v,y,w,'function'==typeof x?x:null]),p},p.sortKeys=function(v){return u='function'==typeof v?v:v||void 0===v?o:null,p},p.sum=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'sum_'+v;return p.aggregate(v,function(y){return y.reduce(function(z,A){return z+A},0)},w,x)},p.mean=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'mean_'+v;return p.aggregate(v,function(y){return y.reduce(function(z,A){return z+A},0)/y.length},w,x)},p.uniq=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'uniq_'+v;return p.aggregate(v,k,w,x)},p.count=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'count_'+v;return p.aggregate(v,function(y){return k(y).length},w,x)},p.min=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'min_'+v;return p.aggregate(v,g,w,x)},p.max=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'max_'+v;return p.aggregate(v,h,w,x)},p.range=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:'range_'+v;return p.aggregate(v,j,w,x)},p.one=function(v,w){var x=2<arguments.length&&void 0!==arguments[2]?arguments[2]:v;return p.aggregate(v,function(y){return y[0]},w,x)},p.groupBy=function(v){return t=null==v?[]:Array.isArray(v)?v.filter(function(w){return null!=w}):[v],p},p.copy=function(){var v=c().groupBy(t);return q.forEach(function(w){return v.filter(w)}),r.forEach(function(w){return v.aggregate(w[0],w[2],w[3],w[1])}),v.sortKeys(u),v},p.data=p,p}var e=function normalize(p){return p?p.valueOf():p},f=function defined(p){return p!==void 0},g=function min(p){for(var q=void 0,r=0;r<p.length;r++)(void 0==q||p[r]<q)&&(q=p[r]);return q},h=function max(p){for(var q=void 0,r=0;r<p.length;r++)(void 0==q||p[r]>q)&&(q=p[r]);return q},j=function extent(p){for(var q=void 0,r=void 0,t=0;t<p.length;t++)(void 0==q||p[t]>q)&&(q=p[t]),(void 0==r||p[t]<r)&&(r=p[t]);return[r,q]},k=function uniq(p){var q=[],r=[];return p.forEach(function(t){var u=e(t);-1===q.indexOf(u)&&(q.push(u),r.push(t))}),r},l=function aggregations(p,q){for(var r=function _loop(t){var u=_slicedToArray(q[t],4),v=u[0],w=u[1],x=u[2],y=u[3],z=x(p.values.map(function(A){return A[v]}).filter(function(A){return A!==void 0}));p[w]=y?y(z):z},t=0;t<q.length;t++)r(t);return p},m=function splitBy(p,q,r){if(q.length){var u=new Map,v=q[0],w='function'==typeof v?v:function(x){return x[v]};p.forEach(function(x){var y=w(x),z=w(x).valueOf(),A=u.get(z);A?A.values.push(x):u.set(z,{key:y,values:[x]})}),p=Array.from(u.values())}else p=[{key:null,values:p}];var t=q.slice(1);return p=p.map(function(u){return l(u,r),t.length&&(u.values=m(u.values,t,r)),u}),p},o=function collate(p,q){return p<q?-1:p>q?1:p>=q?0:NaN};return c});

